<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Ay, mi vocabulario! - Legends Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Fredoka:wght@400;600&family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <audio id="backgroundMusic" loop>
        <source src="https://dl.dropboxusercontent.com/scl/fi/6jxlz0z5jfu83khvsk3dd/medieval-star-188280-1.mp3?rlkey=if6ox7pyl1ayo5s8c7xa8vubt&st=e846ldk3" type="audio/mpeg">
    </audio>

    <style>
        :root {
            --spain-red: #AA151B;
            --spain-yellow: #F1BF00;
            --bg-sand: #FFF9E6;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--bg-sand);
            margin: 0; padding: 0; overflow-x: hidden; color: #432818;
            text-align: center;
        }

        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(135deg, var(--spain-red) 0%, #7a0e12 100%);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        #board-container {
            width: min(95vw, 700px);
            margin: 1.5rem auto;
            aspect-ratio: 1 / 1;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            width: 100%; height: 100%;
            border: 8px solid var(--spain-yellow);
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .cell {
            border: 1px solid rgba(0, 0, 0, 0.04);
            position: relative;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; font-weight: 800; color: rgba(0,0,0,0.1);
        }
        .cell:nth-child(even) { background-color: #fffdf2; }

        .player-avatar {
            width: 32px; height: 32px;
            border-radius: 6px;
            position: absolute;
            border: 2px solid white;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 20;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            font-size: 1.2rem;
            pointer-events: none;
            background-size: cover;
            background-position: center;
            overflow: hidden;
            color: white; 
            text-shadow: 0px 0px 3px rgba(0,0,0,0.5);
        }

        .current-player-glow {
            box-shadow: 0 0 15px var(--spain-yellow), 0 0 5px white;
            z-index: 50; transform: scale(1.4) !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px; padding: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.06);
            border: 3px solid var(--spain-yellow);
            margin-bottom: 1.5rem;
        }

        .avatar-option {
            cursor: pointer; transition: transform 0.2s;
            font-size: 1.2rem; padding: 2px; border-radius: 6px;
            border: 2px solid transparent;
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
        }
        .avatar-option:hover { transform: scale(1.1); background: #fef3c7; }
        .avatar-selected { border-color: var(--spain-yellow); background: #fffbeb !important; }

        .dice-box { width: 70px; height: 70px; perspective: 1000px; display: inline-block; }
        .dice { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
        .dice.rolling { animation: dice-spin 0.2s infinite linear; }
        @keyframes dice-spin { 0% { transform: rotateX(0deg); } 100% { transform: rotateX(360deg) rotateY(360deg); } }
        
        .strike-dot { width: 12px; height: 12px; border-radius: 50%; background: #e5e7eb; display: inline-block; margin: 0 4px; }
        .strike-active { background: #ef4444; box-shadow: 0 0 10px #f87171; }

        .copyright-section {
            width: 100%; max-width: 800px; margin: 4rem auto 2rem; padding: 2rem;
            border-top: 1px solid rgba(0,0,0,0.08); color: #78350f; font-size: 0.85rem;
            line-height: 1.6;
        }

        .smoke-particle {
            position: absolute; pointer-events: none; border-radius: 50%;
            background: rgba(180, 180, 180, 0.5); animation: smoke-rise linear forwards;
            z-index: 2000;
        }
        @keyframes smoke-rise {
            0% { transform: scale(1) translate(0, 0); opacity: 0.6; }
            100% { transform: scale(3) translate(var(--tx), var(--ty)); opacity: 0; }
        }
    </style>
</head>
<body class="flex flex-col items-center">

    <div id="splash-screen" onclick="dismissSplash()">
        <div class="text-white cursor-pointer text-center">
            <h1 class="text-7xl font-bold mb-4 drop-shadow-lg">¬°BIENVENIDOS!</h1>
            <p class="text-xl tracking-widest animate-pulse font-semibold">COLEGIO SAN JUAN - EISTEDDFOD 2026</p>
            <p class="mt-8 text-sm opacity-80 uppercase tracking-tighter">[ CLICK ANYWHERE TO START ]</p>
        </div>
    </div>

    <div id="game-content" class="opacity-0 transition-opacity duration-1000 p-4 w-full max-w-3xl flex flex-col items-center">
        
        <header class="mb-6">
            <h1 class="text-6xl text-red-700 font-black mb-3 italic">¬°Ay, mi vocabulario!</h1>
            <div class="flex gap-3 justify-center">
                <button onclick="downloadGameData()" class="text-xs font-bold bg-white border-2 border-yellow-400 px-4 py-1.5 rounded-full shadow-sm hover:bg-yellow-50">üíæ Save</button>
                <label class="text-xs font-bold bg-white border-2 border-yellow-400 px-4 py-1.5 rounded-full shadow-sm hover:bg-yellow-50 cursor-pointer">
                    üìÇ Load <input type="file" id="loadInput" class="hidden" accept=".json" onchange="loadGameData(event)">
                </label>
            </div>
        </header>

        <section id="setupArea" class="w-full">
            <div class="glass-panel">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-black text-red-700 uppercase">1. Prepare Players</h2>
                    <div class="flex items-center gap-2">
                        <input type="number" id="numPlayers" min="1" max="4" value="2" class="border-2 border-yellow-400 p-1 rounded-lg w-16 text-center font-bold outline-none">
                        <button onclick="createPlayerInputs()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-1 rounded-lg font-bold text-xs transition">REFRESH</button>
                    </div>
                </div>
                
                <div id="playerEntries" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>
                
                <button id="startGameButton" onclick="startGame()" class="w-full bg-red-700 text-white py-4 rounded-2xl font-black text-xl shadow-xl hover:bg-red-800 transition transform active:scale-95 border-b-8 border-red-900">
                    START THE QUEST üé≤
                </button>
            </div>
        </section>

        <section id="gameUI" class="hidden w-full">
            <div class="glass-panel flex justify-between items-center px-8">
                <div class="flex items-center gap-4">
                    <div id="pAvatarDisplay" class="text-5xl bg-yellow-100 p-2 rounded-xl border-2 border-yellow-400 w-16 h-16 flex items-center justify-center overflow-hidden">üë§</div>
                    <div class="text-left">
                        <p class="text-[10px] text-stone-400 uppercase font-black">Turno de</p>
                        <h3 id="turnDisplay" class="text-2xl font-black leading-tight">...</h3>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-stone-400 uppercase font-black mb-1">Strikes</p>
                    <div id="strikeContainer">
                        <span class="strike-dot"></span>
                        <span class="strike-dot"></span>
                        <span class="strike-dot"></span>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <div id="quizBox" class="hidden mb-6 p-6 bg-red-50 rounded-2xl border-4 border-red-200 animate-pulse">
                    <p id="quizPrompt" class="text-lg font-black mb-4 text-red-900"></p>
                    <div class="flex gap-2 max-w-xs mx-auto">
                        <input type="text" id="quizInput" maxlength="1" placeholder="?" class="w-16 p-3 border-4 border-red-400 rounded-xl text-center text-2xl font-black uppercase outline-none">
                        <button onclick="submitAnswer()" class="flex-1 bg-green-600 hover:bg-green-700 text-white rounded-xl font-black text-lg shadow-lg">OK</button>
                    </div>
                </div>
                <div class="flex justify-center items-center gap-12 mb-4">
                    <div class="dice-box"><div id="dice" class="dice"><div class="die-face flex items-center justify-center bg-white border-2 border-stone-200 rounded-xl text-4xl w-full h-full">üé≤</div></div></div>
                    <button id="rollBtn" onclick="rollDice()" class="bg-red-600 text-white px-12 py-4 rounded-xl font-black text-lg shadow-xl hover:bg-red-700 transition border-b-4 border-red-900">ROLL DICE</button>
                </div>
                <div class="font-black text-stone-400 text-xs">SQUARE: <span id="posDisplay" class="text-red-600 text-xl">01</span> / 100</div>
            </div>

            <div id="board-container"><div id="board"></div></div>
        </section>

        <footer class="copyright-section">
            <p id="code-stats" class="mb-4 font-black text-red-800 text-[11px] opacity-60 uppercase tracking-widest"></p>
            <p class="mb-4 font-medium italic text-stone-600">
                This project - <span id="chaos-stats">...</span> of handcrafted chaos - is the product of <strong>way</strong> too much caffeine; blood, sweat, and tears; and not nearly enough sleep. 
                So do me a favour: <strong>don‚Äôt steal it, don‚Äôt sell it, and don‚Äôt Frankenstein it into something else.</strong> 
                It‚Äôs licensed under CC BY-NC-ND, which means respect the work or go write your own (but don't steal my idea üëÄ).
            </p>
            <p class="text-stone-400 font-bold text-[10px] tracking-widest uppercase">¬© 2026 Ayden Kharoti. All rights reserved.</p>
        </footer>
    </div>

    <div id="feedback-overlay" class="fixed inset-0 pointer-events-none flex items-center justify-center z-[2000] opacity-0 transition-all duration-300">
        <div id="feedback-text" class="text-9xl transform scale-50 transition-transform duration-500"></div>
    </div>

    <script>
        const LADDERS = { 6: 25, 14: 36, 21: 42, 35: 58, 52: 74, 66: 88, 77: 96, 82: 98 }; 
        const SNAKES = { 12: 3, 28: 10, 41: 19, 49: 30, 62: 45, 89: 68, 94: 75, 99: 1 };  
        const AVATARS = ['üé≤', 'üèπ', 'üõ°Ô∏è', '‚öîÔ∏è', 'üßô', 'üëë', 'üêâ', 'üíÉ', 'ü•ò', 'ü¶ä', 'ü¶Ñ', 'üåÆ', 'üé≠', 'üé®', 'ü¶Å', 'ü¶â', 'üçï', '‚öΩ', 'üöÄ'];
        const SPANISH_NAMES = ['Alejandro', 'Beatriz', 'Carlos', 'Diego', 'Elena', 'Fernando', 'Gabriela', 'Hugo', 'Isabel', 'Javier', 'Luc√≠a', 'Mateo'];
        
        const QUESTIONS = [
            { q: "¬øC√≥mo se dice 'The breakfast' en espa√±ol?\nA: La cena | B: El desayuno | C: El almuerzo", a: "B" },
            { q: "¬øQu√© es 'Hermano' en ingl√©s?\nA: Brother | B: Cousin | C: Uncle", a: "A" },
            { q: "¬øC√≥mo se dice 'I am 12 years old' en espa√±ol?\nA: Soy 12 | B: Tengo 12 a√±os | C: Estoy 12", a: "B" },
            { q: "¬øDe qu√© color es 'Amarillo'?\nA: Azul | B: Verde | C: Amarillo", a: "C" },
            { q: "¬øC√≥mo se dice 'Library' en espa√±ol?\nA: Librer√≠a | B: Biblioteca | C: Tienda", a: "B" }
        ];

        let players = [];
        let currentPlayer = 0;
        let isMoving = false;
        let playerSelection = {};

        window.onload = function() {
            updateCodeStats();
            createPlayerInputs();
        };

        function updateCodeStats() {
            const code = document.documentElement.outerHTML;
            const lines = code.split('\n').length;
            const words = code.split(/\s+/).filter(w => w.length > 0).length;
            const chars = code.length;

            document.getElementById('code-stats').innerText = `${lines} lines - ${words} words - ${chars} characters... Of HTML, JS and CSS.`;
            document.getElementById('chaos-stats').innerText = `${lines} lines, ${words} words, and ${chars} characters`;
        }

        function dismissSplash() {
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash-screen').style.visibility = 'hidden';
                document.getElementById('game-content').style.opacity = '1';
                document.getElementById('backgroundMusic').play().catch(() => {});
            }, 800);
        }

        function createPlayerInputs() {
            const n = Math.min(Math.max(document.getElementById('numPlayers').value, 1), 4);
            const container = document.getElementById('playerEntries');
            container.innerHTML = '';
            playerSelection = {};

            let shuffled = [...AVATARS].sort(() => 0.5 - Math.random());

            for(let i=0; i<n; i++) {
                const defaultEmoji = shuffled[i];
                playerSelection[i] = { type: 'emoji', val: defaultEmoji };

                const div = document.createElement('div');
                div.className = "bg-white p-3 rounded-xl border-2 border-stone-100 shadow-sm text-left";
                div.innerHTML = `
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="name-${i}" placeholder="Jugador ${i+1}" class="flex-1 p-1.5 border-2 border-stone-100 rounded-lg font-bold text-sm outline-none focus:border-yellow-400">
                        <button onclick="randomizeName(${i})" class="bg-stone-100 px-2 rounded-lg text-xs">üé≤</button>
                    </div>
                    <div class="flex flex-wrap gap-1" id="av-list-${i}">
                        ${AVATARS.map(a => `<span class="avatar-option ${a === defaultEmoji ? 'avatar-selected' : ''}" onclick="setAvatar(${i}, 'emoji', '${a}', this)">${a}</span>`).join('')}
                        <label class="avatar-option bg-stone-50 border-stone-100 hover:bg-stone-100" title="Upload Pic">
                            üì∑ <input type="file" class="hidden" accept="image/*" onchange="uploadPic(event, ${i})">
                        </label>
                    </div>
                    <div id="preview-${i}" class="mt-2 flex items-center gap-2">
                        <span class="text-[9px] font-black text-stone-300 uppercase">Selected:</span>
                        <div id="prev-box-${i}" class="w-6 h-6 rounded bg-stone-50 border border-stone-200 flex items-center justify-center text-xs overflow-hidden">
                            ${defaultEmoji}
                        </div>
                    </div>
                `;
                container.appendChild(div);
            }
        }

        function randomizeName(idx) {
            document.getElementById(`name-${idx}`).value = SPANISH_NAMES[Math.floor(Math.random() * SPANISH_NAMES.length)];
        }

        function setAvatar(pIdx, type, val, el) {
            playerSelection[pIdx] = { type, val };
            const list = document.getElementById(`av-list-${pIdx}`);
            list.querySelectorAll('.avatar-option').forEach(o => o.classList.remove('avatar-selected'));
            if(el) el.classList.add('avatar-selected');

            const box = document.getElementById(`prev-box-${pIdx}`);
            if(type === 'emoji') {
                box.innerHTML = val; box.style.backgroundImage = '';
            } else {
                box.innerHTML = ''; box.style.backgroundImage = `url(${val})`;
                box.style.backgroundSize = 'cover'; box.style.backgroundPosition = 'center';
            }
        }

        function uploadPic(e, pIdx) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const label = e.target.closest('label');
                setAvatar(pIdx, 'img', ev.target.result, label);
            };
            reader.readAsDataURL(file);
        }

        function startGame() {
            const n = document.getElementById('numPlayers').value;
            players = [];
            for(let i=0; i<n; i++) {
                players.push({
                    name: document.getElementById(`name-${i}`).value || `Hero ${i+1}`,
                    avatar: playerSelection[i].val,
                    avatarType: playerSelection[i].type,
                    pos: 1, strikes: 0,
                    color: ['#AA151B', '#166534', '#1e40af', '#92400e'][i]
                });
            }
            const btn = document.getElementById('startGameButton');
            const rect = btn.getBoundingClientRect();
            createSmokeEffect(rect.left + rect.width/2, rect.top + rect.height/2);
            
            document.getElementById('setupArea').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            initBoard();
            updateUI();
        }

        function initBoard() {
            const b = document.getElementById('board');
            b.innerHTML = '';
            for (let r = 9; r >= 0; r--) {
                for (let c = 0; c < 10; c++) {
                    const num = (r % 2 === 0) ? (r * 10 + c + 1) : (r * 10 + (9 - c) + 1);
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `c-${num}`;
                    cell.innerHTML = `<span>${num}</span>`;
                    b.appendChild(cell);
                }
            }
            drawMarkers();
        }

        function rollDice() {
            if(isMoving) return;
            isMoving = true;
            const die = document.getElementById('dice');
            const roll = Math.floor(Math.random() * 6) + 1;
            die.classList.add('rolling');
            document.getElementById('rollBtn').disabled = true;
            setTimeout(() => {
                die.classList.remove('rolling');
                die.innerHTML = `<div class="die-face flex items-center justify-center bg-white border-2 border-stone-200 rounded-xl text-4xl w-full h-full">${['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][roll-1]}</div>`;
                setTimeout(() => {
                    const q = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
                    document.getElementById('quizPrompt').innerText = q.q;
                    document.getElementById('quizBox').classList.remove('hidden');
                    document.getElementById('quizInput').value = '';
                    document.getElementById('quizInput').focus();
                    window.activeRound = { roll, correct: q.a };
                }, 400);
            }, 600);
        }

        function submitAnswer() {
            const input = document.getElementById('quizInput');
            const ans = input.value.trim().toUpperCase();
            if(!['A', 'B', 'C'].includes(ans)) return;
            
            const p = players[currentPlayer];
            document.getElementById('quizBox').classList.add('hidden');
            
            if(ans === window.activeRound.correct) {
                p.strikes = 0;
                showFeedback(true);
                movePlayer(p, window.activeRound.roll);
            } else {
                p.strikes++;
                showFeedback(false);
                if(p.strikes >= 3) { p.pos = 1; p.strikes = 0; }
                isMoving = false;
                document.getElementById('rollBtn').disabled = false;
                nextTurn();
            }
        }

        async function movePlayer(p, steps) {
            for(let i=0; i<steps; i++) {
                if(p.pos >= 100) break;
                p.pos++;
                drawMarkers();
                document.getElementById('posDisplay').innerText = p.pos.toString().padStart(2, '0');
                await new Promise(r => setTimeout(r, 200));
            }
            if(LADDERS[p.pos]) p.pos = LADDERS[p.pos];
            if(SNAKES[p.pos]) p.pos = SNAKES[p.pos];
            
            drawMarkers();
            if(p.pos >= 100) alert(`${p.name} Wins!`);
            
            isMoving = false;
            document.getElementById('rollBtn').disabled = false;
            if(window.activeRound.roll !== 6) nextTurn();
            else updateUI();
        }

        function nextTurn() {
            currentPlayer = (currentPlayer + 1) % players.length;
            updateUI();
        }

        function updateUI() {
            const p = players[currentPlayer];
            const display = document.getElementById('pAvatarDisplay');
            document.getElementById('turnDisplay').innerText = p.name;
            document.getElementById('turnDisplay').style.color = p.color;
            
            if(p.avatarType === 'emoji') {
                display.innerText = p.avatar;
                display.style.backgroundImage = '';
            } else {
                display.innerText = '';
                display.style.backgroundImage = `url(${p.avatar})`;
                display.style.backgroundSize = 'cover';
                display.style.backgroundPosition = 'center';
            }
            
            document.querySelectorAll('.strike-dot').forEach((dot, i) => {
                dot.className = i < p.strikes ? 'strike-dot strike-active' : 'strike-dot';
            });
            drawMarkers();
        }

        function drawMarkers() {
            document.querySelectorAll('.player-avatar').forEach(m => m.remove());
            players.forEach((p, i) => {
                const cell = document.getElementById(`c-${p.pos}`);
                if(!cell) return;
                const m = document.createElement('div');
                m.className = `player-avatar ${i === currentPlayer ? 'current-player-glow' : ''}`;
                m.style.backgroundColor = p.color;
                if(p.avatarType === 'emoji') {
                    m.innerText = p.avatar;
                } else {
                    m.style.backgroundImage = `url(${p.avatar})`;
                }
                cell.appendChild(m);
            });
        }

        function showFeedback(correct) {
            const over = document.getElementById('feedback-overlay');
            const txt = document.getElementById('feedback-text');
            txt.innerText = correct ? '‚úÖ' : '‚ùå';
            over.classList.replace('opacity-0', 'opacity-100');
            txt.classList.add('scale-100');
            setTimeout(() => {
                over.classList.replace('opacity-100', 'opacity-0');
                txt.classList.remove('scale-100');
            }, 800);
        }

        function createSmokeEffect(x, y) {
            for (let i = 0; i < 20; i++) {
                const p = document.createElement('div');
                p.className = 'smoke-particle';
                const size = Math.random() * 20 + 10;
                p.style.width = p.style.height = `${size}px`;
                p.style.left = `${x}px`; p.style.top = `${y}px`;
                p.style.setProperty('--tx', `${(Math.random() - 0.5) * 150}px`);
                p.style.setProperty('--ty', `${-Math.random() * 150}px`);
                p.style.animationDuration = `0.8s`;
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
        }

        function downloadGameData() {
            const blob = new Blob([JSON.stringify({players, currentPlayer}, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `vocab_save.json`;
            a.click();
        }

        function loadGameData(e) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const d = JSON.parse(ev.target.result);
                players = d.players; currentPlayer = d.currentPlayer;
                document.getElementById('setupArea').classList.add('hidden');
                document.getElementById('gameUI').classList.remove('hidden');
                initBoard(); updateUI();
            };
            reader.readAsText(e.target.files[0]);
        }
    </script>
</body>
</html>
