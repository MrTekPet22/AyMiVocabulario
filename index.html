<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Ay, mi vocabulario!</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Fredoka:wght@400;600&family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <audio id="backgroundMusic" loop>
        <source src="https://dl.dropbox.com/scl/fi/tyem8nslzhtxlquwsamky/viacheslavstarostin-latin-spanish-spain-music-413509.mp3?rlkey=wb5ux5pdhpdr5k64s9yidjc6h&st=a9maamwn&dl=1" type="audio/mpeg">
    </audio>

    <style>
        :root {
            --spain-red: #AA151B;
            --spain-yellow: #F1BF00;
            --bg-sand: #FFF9E6;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--bg-sand);
            margin: 0; padding: 0; overflow-x: hidden; color: #432818;
            text-align: center;
        }

        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(135deg, var(--spain-red) 0%, #7a0e12 100%);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        #board-container {
            width: min(95vw, 700px);
            margin: 1.5rem auto;
            aspect-ratio: 1 / 1;
            position: relative;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            width: 100%; height: 100%;
            border: 8px solid var(--spain-yellow);
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative;
            z-index: 5;
        }

        .cell {
            border: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 800; 
            color: rgba(67, 40, 24, 0.6);
        }
        .cell:nth-child(even) { background-color: #fffef7; }

        .obstacle-emoji {
            position: absolute;
            font-size: 2.2rem;
            z-index: 8;
            pointer-events: none;
            opacity: 1;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .player-avatar {
            width: 32px; height: 32px;
            border-radius: 6px;
            position: absolute;
            border: 2px solid white;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 20;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            font-size: 1.2rem;
            pointer-events: none;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
            color: white; 
            text-shadow: 0px 0px 3px rgba(0,0,0,0.5);
        }

        .current-player-glow {
            box-shadow: 0 0 15px var(--spain-yellow), 0 0 5px white;
            z-index: 50; transform: scale(1.4) !important;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px; padding: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.06);
            border: 3px solid var(--spain-yellow);
            margin-bottom: 1.5rem;
        }

        .avatar-option {
            cursor: pointer; transition: all 0.2s;
            font-size: 1.2rem; padding: 2px; border-radius: 6px;
            border: 2px solid transparent;
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
        }
        .avatar-option:hover:not(.avatar-taken) { transform: scale(1.1); background: #fef3c7; }
        .avatar-selected { border-color: var(--spain-yellow); background: #fffbeb !important; }
        
        .avatar-taken {
            opacity: 0.15;
            cursor: not-allowed;
            filter: grayscale(1);
            pointer-events: none;
        }

        .dice-box { width: 70px; height: 70px; perspective: 1000px; display: inline-block; }
        .dice { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
        .dice.rolling { animation: dice-spin 0.2s infinite linear; }
        @keyframes dice-spin { 0% { transform: rotateX(0deg); } 100% { transform: rotateX(360deg) rotateY(360deg); } }
        
        .strike-dot { width: 12px; height: 12px; border-radius: 50%; background: #e5e7eb; display: inline-block; margin: 0 4px; }
        .strike-active { background: #ef4444; box-shadow: 0 0 10px #f87171; }

        .copyright-section {
            width: 100%; max-width: 800px; margin: 4rem auto 2rem; padding: 2rem;
            border-top: 1px solid rgba(0,0,0,0.08); color: #78350f; font-size: 0.85rem;
            line-height: 1.6;
        }
    </style>
</head>
<body class="flex flex-col items-center">

    <div id="splash-screen" onclick="dismissSplash()">
        <div class="text-white cursor-pointer text-center">
            <h1 class="text-7xl font-bold mb-4 drop-shadow-lg uppercase">¬°Bienvenidos!</h1>
            <p class="text-xl tracking-widest animate-pulse font-semibold">Spanish Learning Quest</p>
            <p class="mt-8 text-sm opacity-80 uppercase tracking-tighter">[ CLICK ANYWHERE TO START ]</p>
        </div>
    </div>

    <div id="game-content" class="opacity-0 transition-opacity duration-1000 p-4 w-full max-w-3xl flex flex-col items-center">
        
        <header class="mb-6">
            <h1 class="text-6xl text-red-700 font-black mb-3 italic">¬°Ay, mi vocabulario!</h1>
            <div class="flex gap-3 justify-center">
                <button onclick="downloadGameData()" class="text-xs font-bold bg-white border-2 border-yellow-400 px-4 py-1.5 rounded-full shadow-sm hover:bg-yellow-50">üíæ Save Progress</button>
                <label class="text-xs font-bold bg-white border-2 border-yellow-400 px-4 py-1.5 rounded-full shadow-sm hover:bg-yellow-50 cursor-pointer">
                    üìÇ Load File <input type="file" id="loadInput" class="hidden" accept=".json" onchange="loadGameData(event)">
                </label>
            </div>
        </header>

        <section id="setupArea" class="w-full">
            <div class="glass-panel mb-6 bg-yellow-50 border-dashed">
                <h2 class="text-xl font-black text-red-800 uppercase mb-3 flex items-center justify-center gap-2">
                    üìú Reglas del Juego / Game Rules
                </h2>
                <ul class="text-left text-sm space-y-3 font-bold text-stone-700">
                    <li class="flex gap-2"><span>üé≤</span> 
                        <span><strong>Lanza el dado y responde correctamente para avanzar.</strong><br><span class="text-stone-500 font-medium">Roll the dice and answer correctly to move forward.</span></span>
                    </li>
                    <li class="flex gap-2"><span>ü™ú</span> 
                        <span><strong>Escaleras: ¬°Sube +10 casillas!</strong><br><span class="text-stone-500 font-medium">Ladders: Climb up +10 squares!</span></span>
                    </li>
                    <li class="flex gap-2"><span>üêç</span> 
                        <span><strong>Serpientes: ¬°Baja -10 casillas!</strong><br><span class="text-stone-500 font-medium">Snakes: Slide down -10 squares!</span></span>
                    </li>
                    <li class="flex gap-2"><span>üî•</span> 
                        <span><strong>Bono: ¬°Saca un 6 para un turno extra!</strong><br><span class="text-stone-500 font-medium">Bonus: Roll a 6 for an extra turn!</span></span>
                    </li>
                    <li class="flex gap-2"><span>‚ùå</span> 
                        <span><strong>3 errores te devuelven al inicio.</strong><br><span class="text-stone-500 font-medium">3 wrong answers return you to the start.</span></span>
                    </li>
                </ul>
            </div>

            <div class="glass-panel">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-black text-red-700 uppercase">1. Prepare Players</h2>
                    <div class="flex items-center gap-2">
                        <input type="number" id="numPlayers" min="1" max="4" value="2" class="border-2 border-yellow-400 p-1 rounded-lg w-16 text-center font-bold outline-none">
                        <button onclick="createPlayerInputs()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-1 rounded-lg font-bold text-xs transition">REFRESH</button>
                    </div>
                </div>
                
                <div id="playerEntries" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>
                
                <button id="startGameButton" onclick="startGame()" class="w-full bg-red-700 text-white py-4 rounded-2xl font-black text-xl shadow-xl hover:bg-red-800 transition transform active:scale-95 border-b-8 border-red-900">
                    START THE QUEST üé≤
                </button>
            </div>
        </section>

        <section id="gameUI" class="hidden w-full">
            <div class="glass-panel flex justify-between items-center px-8">
                <div class="flex items-center gap-4">
                    <div id="pAvatarDisplay" class="text-5xl bg-yellow-100 p-2 rounded-xl border-2 border-yellow-400 w-16 h-16 flex items-center justify-center overflow-hidden bg-center bg-cover">üë§</div>
                    <div class="text-left">
                        <p class="text-[10px] text-stone-400 uppercase font-black">Turno de</p>
                        <h3 id="turnDisplay" class="text-2xl font-black leading-tight">...</h3>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-stone-400 uppercase font-black mb-1">Strikes</p>
                    <div id="strikeContainer">
                        <span class="strike-dot"></span>
                        <span class="strike-dot"></span>
                        <span class="strike-dot"></span>
                    </div>
                </div>
            </div>

            <div class="glass-panel">
                <div id="quizBox" class="hidden mb-6 p-6 bg-red-50 rounded-2xl border-4 border-red-200 animate-pulse">
                    <p id="quizPrompt" class="text-lg font-black mb-4 text-red-900"></p>
                    <div class="flex gap-2 max-w-xs mx-auto">
                        <input type="text" id="quizInput" maxlength="1" placeholder="?" class="w-16 p-3 border-4 border-red-400 rounded-xl text-center text-2xl font-black uppercase outline-none">
                        <button onclick="submitAnswer()" class="flex-1 bg-green-600 hover:bg-green-700 text-white rounded-xl font-black text-lg shadow-lg">OK</button>
                    </div>
                </div>
                <div class="flex justify-center items-center gap-12 mb-4">
                    <div class="dice-box"><div id="dice" class="dice"><div class="die-face flex items-center justify-center bg-white border-2 border-stone-200 rounded-xl text-4xl w-full h-full">üé≤</div></div></div>
                    <button id="rollBtn" onclick="rollDice()" class="bg-red-600 text-white px-12 py-4 rounded-xl font-black text-lg shadow-xl hover:bg-red-700 transition border-b-4 border-red-900">ROLL DICE</button>
                </div>
                <div class="font-black text-stone-400 text-xs uppercase">SQUARE: <span id="posDisplay" class="text-red-600 text-xl">01</span> / 100</div>
            </div>

            <div id="board-container">
                <div id="board"></div>
            </div>
        </section>

        <footer class="copyright-section">
            <p id="code-stats" class="mb-4 text-stone-700 text-sm"></p>
        </footer>
    </div>

    <div id="feedback-overlay" class="fixed inset-0 pointer-events-none flex items-center justify-center z-[2000] opacity-0 transition-all duration-300">
        <div id="feedback-text" class="text-9xl transform scale-50 transition-transform duration-500"></div>
    </div>

    <script>
        const LADDERS = [12, 25, 38, 52, 67, 81]; 
        const SNAKES = [18, 31, 45, 62, 77, 94];  
        const AVATARS = ['üá™üá∏', 'ü•ò', 'üíÉ', 'üé∏', 'üçä', '‚öΩ', 'üêÇ', 'üèõÔ∏è', 'üé≠', 'üè∞', 'üåä', 'üåû', 'üç∑', 'ü•ñ'];
        const SPANISH_NAMES = ['Alejandro', 'Beatriz', 'Carlos', 'Diego', 'Elena', 'Fernando', 'Gabriela', 'Hugo', 'Isabel', 'Javier', 'Luc√≠a', 'Mateo'];
        
        const QUESTIONS = [
    { q: "How do you say 'I chat with my friends' in Spanish?\nA: Chateo con mis amigos | B: Mando SMS | C: Saco fotos", a: "A" },
    { q: "What does 'De vez en cuando' mean in English?\nA: Every day | B: From time to time | C: Never", a: "B" },
    { q: "How do you say 'A documentary' in Spanish?\nA: Una comedia | B: Un concurso | C: Un documental", a: "C" },
    { q: "What is the Spanish translation for 'I like it a lot'?\nA: Me gusta mucho | B: No me gusta nada | C: Me encanta", a: "A" },
    { q: "How do you say 'The lyrics' in Spanish?\nA: El ritmo | B: La letra | C: La melod√≠a", a: "B" },
    { q: "What is 'Yesterday' in Spanish?\nA: Luego | B: Ma√±ana | C: Ayer", a: "C" },
    { q: "How do you say 'I went to the cinema' in Spanish (past tense)?\nA: Fui al cine | B: Fuiste al cine | C: Voy al cine", a: "A" },
    { q: "What does 'Hice los deberes' mean in English?\nA: I did gymnastics | B: I did my homework | C: I played online", a: "B" },
    { q: "How do you say 'I watched a film' in Spanish?\nA: Vi una pel√≠cula | B: Viste una pel√≠cula | C: Vi un programa", a: "A" },
    { q: "What is 'Classical music' in Spanish?\nA: La m√∫sica pop | B: La m√∫sica electr√≥nica | C: La m√∫sica cl√°sica", a: "C" },
    { q: "How do you say 'I share my favorite videos' in Spanish?\nA: Comparto mis videos favoritos | B: Veo videos | C: Descargo aplicaciones", a: "A" },
    { q: "What does 'A veces' mean in English?\nA: Always | B: Sometimes | C: Never", a: "B" },
    { q: "How do you say 'A reality TV show' in Spanish?\nA: Un reality | B: Una telenovela | C: Un programa de m√∫sica", a: "A" },
    { q: "What is the Spanish translation for 'I love it'?\nA: Me gusta | B: No me gusta | C: Me encanta", a: "C" },
    { q: "How do you say 'The rhythm' in Spanish?\nA: El ritmo | B: La melod√≠a | C: La letra", a: "A" },
    { q: "What is 'In the morning' in Spanish?\nA: Por la tarde | B: Por la ma√±ana | C: Un poco m√°s tarde", a: "B" },
    { q: "How do you say 'I did gymnastics' in Spanish (past tense)?\nA: Hice los deberes | B: Hice k√°rate | C: Hice gimnasia", a: "C" },
    { q: "What does 'Sal√≠ con mis amigos' mean in English?\nA: I went out with my friends | B: I talked on Skype | C: I played online", a: "A" },
    { q: "How do you say 'I rode my bike' in Spanish?\nA: Mont√© en bici | B: Fui al cine | C: Bail√© en mi cuarto", a: "A" },
    { q: "What is 'Electronic music' in Spanish?\nA: La m√∫sica pop | B: La m√∫sica cl√°sica | C: La m√∫sica electr√≥nica", a: "C" },
    { q: "How do you say 'I download ringtones' in Spanish?\nA: Descargo melod√≠as | B: Chateo con mis amigos | C: Leo mis SMS", a: "A" },
    { q: "What does 'Todos los d√≠as' mean in English?\nA: Every day | B: Two times a week | C: Sometimes", a: "A" },
    { q: "How do you say 'The news' in Spanish?\nA: El telediario | B: Un documental | C: Una serie polic√≠aca", a: "A" },
    { q: "What is the Spanish translation for 'I don't like it at all'?\nA: No me gusta nada | B: Me gusta mucho | C: No me gusta", a: "A" },
    { q: "How do you say 'The tune/melody' in Spanish?\nA: La letra | B: La melod√≠a | C: El ritmo", a: "B" },
    { q: "What is 'Then' in Spanish?\nA: Ayer | B: Luego | C: Un poco m√°s tarde", a: "B" },
    { q: "How do you say 'I danced in my room' in Spanish (past tense)?\nA: Bail√© en mi cuarto | B: Bailaste en mi cuarto | C: Cant√© en mi cuarto", a: "A" },
    { q: "What does 'Jugu√© en l√≠nea' mean in English?\nA: I played online | B: I played for three hours | C: I played football", a: "A" },
    { q: "How do you say 'I talked on Skype' in Spanish?\nA: Habl√© por Skype | B: Hablo por Skype | C: Hablaron por Skype", a: "A" },
    { q: "What is 'Pop music' in Spanish?\nA: La m√∫sica pop | B: La m√∫sica cl√°sica | C: El rap", a: "A" },
    { q: "How do you say 'I take photos' in Spanish?\nA: Saco fotos | B: Mando SMS | C: Veo videos", a: "A" },
    { q: "What does 'Nunca' mean in English?\nA: Never | B: Always | C: Sometimes", a: "A" },
    { q: "How do you say 'A soap opera' in Spanish?\nA: Una telenovela | B: Una comedia | C: Una serie polic√≠aca", a: "A" },
    { q: "What is the Spanish translation for 'Sad'?\nA: Guay | B: Triste | C: Horrible", a: "B" },
    { q: "How do you say 'In my opinion' in Spanish?\nA: Mi opini√≥n | B: En mi opini√≥n | C: Por mi opini√≥n", a: "B" },
    { q: "What is 'In the afternoon' in Spanish?\nA: Por la ma√±ana | B: Por la tarde | C: Luego", a: "B" },
    { q: "How do you say 'I did karate' in Spanish (past tense)?\nA: Hice k√°rate | B: Hice gimnasia | C: Hice los deberes", a: "A" },
    { q: "What does 'Fue' mean in English?\nA: He/She/It went | B: I went | C: You went", a: "A" },
    { q: "How do you say 'I read my texts' in Spanish?\nA: Leo mis SMS | B: Mando SMS | C: Chateo", a: "A" },
    { q: "What is 'A sports programme' in Spanish?\nA: Un programa de deportes | B: Un programa de m√∫sica | C: Un concurso", a: "A" },
    { q: "How do you say 'I send texts' in Spanish?\nA: Leo mis SMS | B: Mando SMS | C: Saco fotos", a: "B" },
    { q: "What does 'Dos o tres veces a la semana' mean?\nA: 2 or 3 times a week | B: 2 or 3 times a month | C: Twice a day", a: "A" },
    { q: "How do you say 'A police series' in Spanish?\nA: Una serie polic√≠aca | B: Una telenovela | C: Un documental", a: "A" },
    { q: "What is the Spanish translation for 'Cool'?\nA: Horrible | B: Guay | C: Triste", a: "B" },
    { q: "How do you say 'My favorite singer' in Spanish?\nA: Mi cantante favorito/a | B: Mi grupo favorito | C: Mi m√∫sica favorita", a: "A" },
    { q: "What is 'A bit later' in Spanish?\nA: Un poco m√°s tarde | B: Luego | C: Ayer", a: "A" },
    { q: "How do you say 'I played for three hours' in Spanish (past tense)?\nA: Jugu√© tres horas | B: Jugu√© en l√≠nea | C: Jugu√© ayer", a: "A" },
    { q: "What does 'Fuiste' mean in English?\nA: I went | B: You went | C: They went", a: "B" },
    { q: "How do you say 'I watch videos or films' in Spanish?\nA: Veo videos o pel√≠culas | B: Veo la tele | C: Saco fotos", a: "A" },
    { q: "What is 'Rap' in Spanish?\nA: El rap | B: El RnB | C: La m√∫sica pop", a: "A" },
    { q: "What is the past tense 'We watched' (ver)?\nA: Vimos | B: Vi | C: Vieron", a: "A" },
    { q: "How do you say 'They watched' (ver) in the past?\nA: Vieron | B: Vio | C: Vimos", a: "A" },
    { q: "What is 'The news' in Spanish?\nA: El telediario | B: La noticia | C: El diario", a: "A" },
    { q: "How do you say 'I download apps' in Spanish?\nA: Descargo aplicaciones | B: Descargo melod√≠as | C: Chateo", a: "A" },
    { q: "What is 'Game show' in Spanish?\nA: Un concurso | B: Un reality | C: Una comedia", a: "A" },
    { q: "How do you say 'Terrible' in Spanish?\nA: Horrible | B: Guay | C: Triste", a: "A" },
    { q: "What is 'I listen to pop music' in Spanish?\nA: Escucho la m√∫sica pop | B: Escucho el rap | C: Me gusta el pop", a: "A" },
    { q: "How do you say 'I listen to electronic music' in Spanish?\nA: Escucho la m√∫sica electr√≥nica | B: Me gusta la electr√≥nica | C: Escucho rap", a: "A" },
    { q: "What is the Spanish for 'I don't like it'?\nA: No me gusta | B: Me gusta | C: Me encanta", a: "A" },
    { q: "What is the past tense of 'hacer' for 'you' (singular)?\nA: Hiciste | B: Hice | C: Hizo", a: "A" },
    { q: "What is the past tense of 'hacer' for 'he/she'?\nA: Hizo | B: Hiciste | C: Hicieron", a: "A" },
    { q: "What is the past tense of 'hacer' for 'we'?\nA: Hicimos | B: Hicisteis | C: Hicieron", a: "A" },
    { q: "What is the past tense of 'hacer' for 'they'?\nA: Hicieron | B: Hicimos | C: Hizo", a: "A" },
    { q: "How do you say 'We went out' (salir) in the past?\nA: Salimos | B: Sal√≠ | C: Salieron", a: "A" },
    { q: "How do you say 'You (singular) went out' (salir) in the past?\nA: Saliste | B: Sal√≠ | C: Sali√≥", a: "A" },
    { q: "How do you say 'They went out' (salir) in the past?\nA: Salieron | B: Sali√≥ | C: Salimos", a: "A" },
    { q: "What is 'You (singular) watched' (ver) in the past?\nA: Viste | B: Vi | C: Vio", a: "A" },
    { q: "What is 'He/She watched' (ver) in the past?\nA: Vio | B: Vi | C: Vimos", a: "A" },
    { q: "How do you say 'I visited' in Spanish?\nA: Visit√© | B: Visitaste | C: Visit√≥", a: "A" },
    { q: "How do you say 'You (singular) visited' in Spanish?\nA: Visitaste | B: Visit√© | C: Visit√≥", a: "A" },
    { q: "How do you say 'He/She visited' in Spanish?\nA: Visit√≥ | B: Visitaste | C: Visitaron", a: "A" },
    { q: "How do you say 'We visited' in Spanish?\nA: Visitamos | B: Visit√© | C: Visitasteis", a: "A" },
    { q: "How do you say 'You (plural) visited' in Spanish?\nA: Visitasteis | B: Visitamos | C: Visit√≥", a: "A" },
    { q: "How do you say 'They visited' in Spanish?\nA: Visitaron | B: Visit√≥ | C: Visitasteis", a: "A" },
    { q: "How do you say 'I drank' in Spanish?\nA: Beb√≠ | B: Bebiste | C: Bebi√≥", a: "A" },
    { q: "How do you say 'You (singular) drank' in Spanish?\nA: Bebiste | B: Beb√≠ | C: Bebi√≥", a: "A" },
    { q: "How do you say 'He/She drank' in Spanish?\nA: Bebi√≥ | B: Bebiste | C: Bebieron", a: "A" },
    { q: "How do you say 'We drank' in Spanish?\nA: Bebimos | B: Bebisteis | C: Bebieron", a: "A" },
    { q: "How do you say 'You (plural) drank' in Spanish?\nA: Bebisteis | B: Bebimos | C: Bebi√≥", a: "A" },
    { q: "How do you say 'They drank' in Spanish?\nA: Bebieron | B: Bebi√≥ | C: Bebimos", a: "A" },
    { q: "What is 'I was' or 'I went'?\nA: Fui | B: Fuiste | C: Fue", a: "A" },
    { q: "What is 'You (singular) were' or 'You went'?\nA: Fuiste | B: Fui | C: Fue", a: "A" },
    { q: "What is 'He/She was' or 'He/She went'?\nA: Fue | B: Fui | C: Fueron", a: "A" },
    { q: "What is 'We were' or 'We went'?\nA: Fuimos | B: Fui | C: Fueron", a: "A" },
    { q: "What is 'You (plural) were' or 'You went'?\nA: Fuisteis | B: Fuimos | C: Fueron", a: "A" },
    { q: "What is 'They were' or 'They went'?\nA: Fueron | B: Fue | C: Fuimos", a: "A" },
    { q: "How do you say 'What do you do on your mobile?'\nA: ¬øQu√© haces con tu m√≥vil? | B: ¬øQu√© tipo de m√∫sica te gusta? | C: ¬øQu√© hiciste ayer?", a: "A" },
    { q: "How do you say 'I send texts' in Spanish?\nA: Mando SMS | B: Leo mis SMS | C: Chateo", a: "A" },
    { q: "How do you say 'I read my texts' in Spanish?\nA: Leo mis SMS | B: Mando SMS | C: Saco fotos", a: "A" },
    { q: "What is 'Because' in Spanish?\nA: Porque | B: Por qu√© | C: Pero", a: "A" },
    { q: "How do you say 'Because it is cool'?\nA: Porque es guay | B: Porque es triste | C: Porque es horrible", a: "A" },
    { q: "How do you say 'Because it is sad'?\nA: Porque es triste | B: Porque es guay | C: Porque es horrible", a: "A" },
    { q: "How do you say 'Because it is terrible'?\nA: Porque es horrible | B: Porque es guay | C: Porque es triste", a: "A" },
    { q: "What is 'My favorite band' in Spanish?\nA: Mi grupo favorito | B: Mi cantante favorito | C: Mi programa favorito", a: "A" },
    { q: "What is 'My favorite singer' in Spanish?\nA: Mi cantante favorito/a | B: Mi grupo favorito | C: Mi programa favorito", a: "A" },
    { q: "How do you say 'I listen to everything'?\nA: Escucho de todo | B: Escucho de nada | C: No escucho", a: "A" },
    { q: "What is 'RnB' in Spanish?\nA: El RnB | B: El rap | C: El pop", a: "A" },
    { q: "How do you say 'Music programme'?\nA: Un programa de m√∫sica | B: Un programa de deportes | C: Un concurso", a: "A" },
    { q: "How do you say 'Sports programme'?\nA: Un programa de deportes | B: Un programa de m√∫sica | C: Un concurso", a: "A" },
    { q: "How do you say 'Police series'?\nA: Una serie polic√≠aca | B: Una telenovela | C: Un documental", a: "A" },
    { q: "How do you say 'Soap opera'?\nA: Una telenovela | B: Una comedia | C: Un reality", a: "A" },
    { q: "How do you say 'Comedy'?\nA: Una comedia | B: Una telenovela | C: Un documental", a: "A" },
    { q: "What is 'The news' (TV)?\nA: El telediario | B: El documental | C: El concurso", a: "A" },
    { q: "How do you say 'What did you do yesterday?'\nA: ¬øQu√© hiciste ayer? | B: ¬øQu√© haces con tu m√≥vil? | C: ¬øQu√© m√∫sica escuchas?", a: "A" },
    { q: "How do you say 'I danced' (past)?\nA: Bail√© | B: Bailo | C: Bailaste", a: "A" },
    { q: "How do you say 'I talked' (past)?\nA: Habl√© | B: Hablo | C: Hablaste", a: "A" },
    { q: "How do you say 'I did' (past)?\nA: Hice | B: Hago | C: Hiciste", a: "A" },
    { q: "How do you say 'I played' (past)?\nA: Jugu√© | B: Juego | C: Jugaste", a: "A" },
    { q: "How do you say 'I rode' (past)?\nA: Mont√© | B: Monto | C: Montaste", a: "A" },
    { q: "How do you say 'I watched/saw' (past)?\nA: Vi | B: Veo | C: Viste", a: "A" },
    { q: "How do you say 'I went out' (past)?\nA: Sal√≠ | B: Salgo | C: Saliste", a: "A" },
    { q: "How do you say 'In the morning'?\nA: Por la ma√±ana | B: Por la tarde | C: Luego", a: "A" },
    { q: "How do you say 'In the afternoon'?\nA: Por la tarde | B: Por la ma√±ana | C: Luego", a: "A" },
    { q: "How do you say 'A bit later'?\nA: Un poco m√°s tarde | B: Luego | C: Ayer", a: "A" },
    { q: "How do you say 'Then/Later'?\nA: Luego | B: Ayer | C: Un poco m√°s tarde", a: "A" },
    { q: "What is 'Lyrics' in Spanish?\nA: La letra | B: El ritmo | C: La melod√≠a", a: "A" },
    { q: "What is 'Rhythm' in Spanish?\nA: El ritmo | B: La letra | C: La melod√≠a", a: "A" },
    { q: "What is 'Melody' in Spanish?\nA: La melod√≠a | B: La letra | C: El ritmo", a: "A" },
    { q: "How do you say 'I really like'?\nA: Me gusta mucho | B: No me gusta nada | C: Me gusta", a: "A" },
    { q: "How do you say 'I don't like at all'?\nA: No me gusta nada | B: Me gusta mucho | C: No me gusta", a: "A" },
    { q: "What is 'I love'?\nA: Me encanta | B: Me gusta | C: No me gusta", a: "A" },
    { q: "How do you say 'I like ...'s music'?\nA: Me gusta la m√∫sica de... | B: Escucho la m√∫sica de... | C: Me encanta la m√∫sica de...", a: "A" },
    { q: "How do you say 'Do you like ...'s music?'\nA: ¬øTe gusta la m√∫sica de...? | B: ¬øQu√© m√∫sica escuchas? | C: ¬øTe gusta la m√∫sica?", a: "A" },
    { q: "How do you say 'Every day'?\nA: Todos los d√≠as | B: Nunca | C: A veces", a: "A" },
    { q: "How do you say 'Sometimes'?\nA: A veces | B: Nunca | C: Todos los d√≠as", a: "A" },
    { q: "How do you say 'Never'?\nA: Nunca | B: A veces | C: Todos los d√≠as", a: "A" },
    { q: "How do you say '2 or 3 times a week'?\nA: Dos o tres veces a la semana | B: De vez en cuando | C: A veces", a: "A" },
    { q: "How do you say 'I play online'?\nA: Juego en l√≠nea | B: Juego tres horas | C: Juego con amigos", a: "A" },
    { q: "How do you say 'I played for three hours' (past)?\nA: Jugu√© tres horas | B: Jugu√© en l√≠nea | C: Jugamos tres horas", a: "A" },
    { q: "How do you say 'I played online with my friends' (past)?\nA: Jugu√© en l√≠nea con mis amigos | B: Juego en l√≠nea con mis amigos | C: Jugu√© con mis amigos", a: "A" },
    { q: "How do you say 'I danced in my room' (past)?\nA: Bail√© en mi cuarto | B: Bailo en mi cuarto | C: Bailaste en mi cuarto", a: "A" },
    { q: "How do you say 'I talked on Skype' (past)?\nA: Habl√© por Skype | B: Hablo por Skype | C: Hablaste por Skype", a: "A" },
    { q: "How do you say 'I did gymnastics' (past)?\nA: Hice gimnasia | B: Hago gimnasia | C: Hiciste gimnasia", a: "A" },
    { q: "How do you say 'I did karate' (past)?\nA: Hice k√°rate | B: Hago k√°rate | C: Hiciste k√°rate", a: "A" },
    { q: "How do you say 'I rode my bike' (past)?\nA: Mont√© en bici | B: Monto en bici | C: Montaste en bici", a: "A" },
    { q: "How do you say 'I watched a film' (past)?\nA: Vi una pel√≠cula | B: Veo una pel√≠cula | C: Viste una pel√≠cula", a: "A" },
    { q: "How do you say 'I went out with my friends' (past)?\nA: Sal√≠ con mis amigos | B: Salgo con mis amigos | C: Saliste con mis amigos", a: "A" },
    { q: "How do you say 'I didn't do my homework' (past)?\nA: No hice los deberes | B: Hice los deberes | C: No hago los deberes", a: "A" },
    { q: "How do you say 'What type of music do you like?'\nA: ¬øQu√© tipo de m√∫sica te gusta? | B: ¬øQu√© tipo de m√∫sica escuchas? | C: ¬øTe gusta la m√∫sica?", a: "A" },
    { q: "How do you say 'What type of music do you listen to?'\nA: ¬øQu√© tipo de m√∫sica escuchas? | B: ¬øQu√© tipo de m√∫sica te gusta? | C: ¬øTe gusta la m√∫sica?", a: "A" },
    { q: "How do you say 'I listen to rap'?\nA: Escucho rap | B: Escucho el rap | C: Me gusta el rap", a: "A" },
    { q: "How do you say 'I listen to the music of...'?\nA: Escucho la m√∫sica de... | B: Me gusta la m√∫sica de... | C: Escucho rap", a: "A" },
    { q: "How do you say 'I listen to everything'?\nA: Escucho de todo | B: Escucho de nada | C: No escucho", a: "A" },
    { q: "What is 'Pop music' in Spanish?\nA: La m√∫sica pop | B: La m√∫sica cl√°sica | C: El rap", a: "A" },
    { q: "What is 'Electronic music' in Spanish?\nA: La m√∫sica electr√≥nica | B: La m√∫sica pop | C: La m√∫sica cl√°sica", a: "A" },
    { q: "What is 'Classical music' in Spanish?\nA: La m√∫sica cl√°sica | B: La m√∫sica pop | C: La m√∫sica electr√≥nica", a: "A" },
    { q: "How do you say 'I share videos'?\nA: Comparto mis videos | B: Veo mis videos | C: Descargo videos", a: "A" },
    { q: "How do you say 'I download ringtones'?\nA: Descargo melod√≠as | B: Descargo aplicaciones | C: Comparto melod√≠as", a: "A" },
    { q: "How do you say 'I download apps'?\nA: Descargo aplicaciones | B: Descargo melod√≠as | C: Comparto aplicaciones", a: "A" },
    { q: "How do you say 'I take photos'?\nA: Saco fotos | B: Veo fotos | C: Mando fotos", a: "A" },
    { q: "How do you say 'I watch videos'?\nA: Veo videos | B: Saco videos | C: Mando videos", a: "A" },
    { q: "How do you say 'I watch films'?\nA: Veo pel√≠culas | B: Saco pel√≠culas | C: Mando pel√≠culas", a: "A" },
    { q: "How do you say 'I play' (games)?\nA: Juego | B: Juegos | C: Juegas", a: "A" },
    { q: "What is 'Un reality' in English?\nA: A reality TV show | B: A soap opera | C: A documentary", a: "A" },
    { q: "What is 'Una comedia' in English?\nA: A comedy | B: A tragedy | C: A drama", a: "A" },
    { q: "What is 'Un documental' in English?\nA: A documentary | B: A game show | C: A news show", a: "A" },
    { q: "What is 'Un concurso' in English?\nA: A game show | B: A comedy | C: A soap opera", a: "A" },
    { q: "What is 'El telediario' in English?\nA: The news | B: The radio | C: The phone", a: "A" },
    { q: "What is 'Una serie polic√≠aca' in English?\nA: A police series | B: A reality show | C: A soap opera", a: "A" },
    { q: "What is 'Una telenovela' in English?\nA: A soap opera | B: A news show | C: A comedy", a: "A" },
    { q: "How do you say 'to visit' (past tense, plural you)?\nA: Visitasteis | B: Visitamos | C: Visitaron", a: "A" },
    { q: "How do you say 'to visit' (past tense, we)?\nA: Visitamos | B: Visit√© | C: Visitasteis", a: "A" },
    { q: "How do you say 'to drink' (past tense, I)?\nA: Beb√≠ | B: Bebiste | C: Bebi√≥", a: "A" },
    { q: "How do you say 'to drink' (past tense, they)?\nA: Bebieron | B: Bebi√≥ | C: Bebisteis", a: "A" },
    { q: "How do you say 'to leave' (past tense, he/she)?\nA: Sali√≥ | B: Saliste | C: Sal√≠", a: "A" },
    { q: "How do you say 'to leave' (past tense, they)?\nA: Salieron | B: Salimos | C: Sali√≥", a: "A" },
    { q: "What is 'hacer' (past tense, he/she)?\nA: Hizo | B: Hice | C: Hicieron", a: "A" },
    { q: "What is 'hacer' (past tense, I)?\nA: Hice | B: Hiciste | C: Hizo", a: "A" },
    { q: "What is 'ver' (past tense, I)?\nA: Vi | B: Viste | C: Vio", a: "A" },
    { q: "What is 'ver' (past tense, we)?\nA: Vimos | B: Vieron | C: Visteis", a: "A" },
    { q: "What is 'ir/ser' (past tense, they)?\nA: Fueron | B: Fue | C: Fuimos", a: "A" },
    { q: "What is 'ir/ser' (past tense, we)?\nA: Fuimos | B: Fueron | C: Fuisteis", a: "A" },
    { q: "How do you say 'It's cool' because of 'guay'?\nA: es guay | B: es triste | C: es horrible", a: "A" },
    { q: "How do you say 'It's sad' because of 'triste'?\nA: es triste | B: es guay | C: es horrible", a: "A" },
    { q: "How do you say 'It's horrible' because of 'horrible'?\nA: es horrible | B: es guay | C: es triste", a: "A" },
    { q: "What does 'La letra' mean in a song?\nA: The lyrics | B: The letter | C: The tune", a: "A" },
    { q: "What does 'El ritmo' mean in a song?\nA: The rhythm | B: The rhyme | C: The song", a: "A" },
    { q: "What does 'La melod√≠a' mean in a song?\nA: The tune | B: The melody | C: Both A and B", a: "C" },
    { q: "How do you say 'I love' using 'encantar'?\nA: Me encanta | B: Me gusta | C: No me gusta", a: "A" },
    { q: "How do you say 'I really like' using 'mucho'?\nA: Me gusta mucho | B: No me gusta mucho | C: Me encanta mucho", a: "A" },
    { q: "How do you say 'I don't like at all' using 'nada'?\nA: No me gusta nada | B: Me gusta nada | C: No me gusta", a: "A" },
    { q: "What is 'My favorite singer' (feminine)?\nA: Mi cantante favorita | B: Mi cantante favorito | C: Mi grupo favorito", a: "A" },
    { q: "What is 'My favorite singer' (masculine)?\nA: Mi cantante favorito | B: Mi cantante favorita | C: Mi grupo favorito", a: "A" },
    { q: "How do you say 'In my opinion'?\nA: En mi opini√≥n | B: Mi opini√≥n | C: Por mi opini√≥n", a: "A" },
    { q: "How do you say 'Every day'?\nA: Todos los d√≠as | B: Cada d√≠a | C: Both A and B are correct in Spanish", a: "C" },
    { q: "How do you say 'Twice a week'?\nA: Dos veces a la semana | B: Tres veces a la semana | C: Una vez a la semana", a: "A" },
    { q: "How do you say 'Three times a week'?\nA: Tres veces a la semana | B: Dos veces a la semana | C: Una vez a la semana", a: "A" },
    { q: "What is 'From time to time' in Spanish?\nA: De vez en cuando | B: A veces | C: Nunca", a: "A" },
    { q: "How do you say 'I play online with my friends' (masculine friends)?\nA: Juego en l√≠nea con mis amigos | B: Juego en l√≠nea con mis amigas | C: Juego con amigos", a: "A" },
    { q: "How do you say 'I play online with my friends' (feminine friends)?\nA: Juego en l√≠nea con mis amigas | B: Juego en l√≠nea con mis amigos | C: Juego con amigas", a: "A" },
    { q: "What is 'Ayer'?\nA: Yesterday | B: Today | C: Tomorrow", a: "A" },
    { q: "What is 'Luego'?\nA: Then/Later | B: Before | C: After", a: "A" },
    { q: "What is 'Un poco m√°s tarde'?\nA: A bit later | B: Much later | C: Earlier", a: "A" },
    { q: "What is 'Por la ma√±ana'?\nA: In the morning | B: In the afternoon | C: In the evening", a: "A" },
    { q: "What is 'Por la tarde'?\nA: In the afternoon | B: In the morning | C: At night", a: "A" },
    { q: "How do you say 'I went to the cinema' (past)?\nA: Fui al cine | B: Voy al cine | C: Fuiste al cine", a: "A" },
    { q: "How do you say 'I danced' (past)?\nA: Bail√© | B: Bailo | C: Bailamos", a: "A" },
    { q: "How do you say 'I talked on Skype' (past)?\nA: Habl√© por Skype | B: Hablo por Skype | C: Hablaste por Skype", a: "A" },
    { q: "How do you say 'I did my homework' (past)?\nA: Hice los deberes | B: Hago los deberes | C: Hiciste los deberes", a: "A" },
    { q: "How do you say 'I watched a film' (past)?\nA: Vi una pel√≠cula | B: Veo una pel√≠cula | C: Vieron una pel√≠cula", a: "A" },
    { q: "What is the past tense of 'salir' for 'I'?\nA: Sal√≠ | B: Sali√≥ | C: Saliste", a: "A" },
    { q: "What is the past tense of 'ver' for 'they'?\nA: Vieron | B: Vio | C: Vimos", a: "A" },
    { q: "What is the past tense of 'hacer' for 'we'?\nA: Hicimos | B: Hice | C: Hicieron", a: "A" },
    { q: "How do you say 'They were' (past)?\nA: Fueron | B: Fue | C: Fuimos", a: "A" },
    { q: "How do you say 'We went' (past)?\nA: Fuimos | B: Fueron | C: Fui", a: "A" },
    { q: "How do you say 'You went' (plural, past)?\nA: Fuisteis | B: Fuiste | C: Fuimos", a: "A" },
    { q: "How do you say 'You went' (singular, past)?\nA: Fuiste | B: Fui | C: Fue", a: "A" },
    { q: "How do you say 'I was' (past)?\nA: Fui | B: Fuiste | C: Fue", a: "A" },
    { q: "How do you say 'He went' (past)?\nA: Fue | B: Fui | C: Fuiste", a: "A" },
    { q: "What is the verb for 'to leave' or 'to go out'?\nA: Salir | B: Beber | C: Visitar", a: "A" },
    { q: "What is the verb for 'to drink'?\nA: Beber | B: Salir | C: Visitar", a: "A" },
    { q: "What is the verb for 'to visit'?\nA: Visitar | B: Beber | C: Salir", a: "A" },
    { q: "How do you say 'What do you do on your mobile?'\nA: ¬øQu√© haces con tu m√≥vil? | B: ¬øQu√© tipo de m√∫sica te gusta? | C: ¬øQu√© hiciste ayer?", a: "A" },
    { q: "What does 'Mando SMS' mean?\nA: I send texts | B: I read texts | C: I delete texts", a: "A" },
    { q: "What does 'Leo mis SMS' mean?\nA: I read my texts | B: I send my texts | C: I have texts", a: "A" },
    { q: "What does 'Saco fotos' mean?\nA: I take photos | B: I share photos | C: I look at photos", a: "A" },
    { q: "How do you say 'I watch films' on your mobile?\nA: Veo pel√≠culas | B: Veo videos | C: Veo tele", a: "A" },
    { q: "How do you say 'I watch videos' on your mobile?\nA: Veo videos | B: Veo pel√≠culas | C: Veo tele", a: "A" }
];

        let players = [];
        let currentPlayer = 0;
        let isMoving = false;
        let playerSelection = {};

        window.onload = function() {
            updateCodeStats();
            createPlayerInputs();
        };

        function updateCodeStats() {
            const code = document.documentElement.outerHTML;
            const lines = code.split('\n').length;
            const words = code.split(/\s+/).filter(w => w.length > 0).length;
            const chars = code.length;
            
            document.getElementById('code-stats').innerHTML = `
                This project - ${lines} lines, ${words} words, and ${chars} characters of handcrafted chaos - is the product of way too much caffeine; blood, sweat, and tears; and not nearly enough sleep. 
                So do me a favour: don‚Äôt steal it, don‚Äôt sell it, and don‚Äôt Frankenstein it into something else. 
                It‚Äôs licensed under CC BY-NC-ND, which means respect the work or go write your own (but don't steal my idea üëÄ). 
                <br><br>
                <strong>¬© 2026 Ayden Kharoti. All rights reserved.</strong>
            `;
        }

        function dismissSplash() {
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash-screen').style.visibility = 'hidden';
                document.getElementById('game-content').style.opacity = '1';
                document.getElementById('backgroundMusic').play().catch(() => {});
            }, 800);
        }

        function createPlayerInputs() {
            const n = Math.min(Math.max(document.getElementById('numPlayers').value, 1), 4);
            const container = document.getElementById('playerEntries');
            container.innerHTML = '';
            playerSelection = {};
            let shuffled = [...AVATARS].sort(() => 0.5 - Math.random());
            
            for(let i=0; i<n; i++) {
                const defaultEmoji = shuffled[i];
                playerSelection[i] = { type: 'emoji', val: defaultEmoji };
                const div = document.createElement('div');
                div.className = "bg-white p-3 rounded-xl border-2 border-stone-100 shadow-sm text-left";
                div.innerHTML = `
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="name-${i}" placeholder="Hero Name ${i+1}" class="flex-1 p-1.5 border-2 border-stone-100 rounded-lg font-bold text-sm outline-none focus:border-yellow-400">
                        <button onclick="randomizeName(${i})" class="bg-stone-100 px-2 rounded-lg text-xs">üé≤</button>
                    </div>
                    <div class="flex flex-wrap gap-1 mb-2" id="av-list-${i}">
                        ${AVATARS.slice(0, 10).map(a => `<span data-emoji="${a}" class="avatar-option ${a === defaultEmoji ? 'avatar-selected' : ''}" onclick="setAvatar(${i}, 'emoji', '${a}', this)">${a}</span>`).join('')}
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="bg-red-100 text-red-700 text-[10px] px-3 py-1.5 rounded-full font-bold cursor-pointer hover:bg-red-200 transition">
                            üì∑ Upload Photo
                            <input type="file" class="hidden" accept="image/*" onchange="handleImageUpload(event, ${i})">
                        </label>
                        <div id="prev-box-${i}" class="w-8 h-8 rounded bg-stone-50 border border-stone-200 flex items-center justify-center text-xs overflow-hidden bg-cover bg-center">${defaultEmoji}</div>
                    </div>
                `;
                container.appendChild(div);
            }
            refreshTakenAvatars();
        }

        function refreshTakenAvatars() {
            const allTakenValues = Object.entries(playerSelection).map(([idx, sel]) => sel.val);
            
            document.querySelectorAll('[id^="av-list-"]').forEach((list, playerIdx) => {
                const currentPlayerVal = playerSelection[playerIdx].val;
                
                list.querySelectorAll('.avatar-option').forEach(option => {
                    const emoji = option.getAttribute('data-emoji');
                    if (allTakenValues.includes(emoji) && emoji !== currentPlayerVal) {
                        option.classList.add('avatar-taken');
                    } else {
                        option.classList.remove('avatar-taken');
                    }
                });
            });
        }

        function handleImageUpload(e, pIdx) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const dataUrl = ev.target.result;
                setAvatar(pIdx, 'image', dataUrl, null);
            };
            reader.readAsDataURL(file);
        }

        function randomizeName(idx) {
            document.getElementById(`name-${idx}`).value = SPANISH_NAMES[Math.floor(Math.random() * SPANISH_NAMES.length)];
        }

        function setAvatar(pIdx, type, val, el) {
            playerSelection[pIdx] = { type, val };
            const list = document.getElementById(`av-list-${pIdx}`);
            list.querySelectorAll('.avatar-option').forEach(o => o.classList.remove('avatar-selected'));
            if (el) el.classList.add('avatar-selected');

            const box = document.getElementById(`prev-box-${pIdx}`);
            if (type === 'image') {
                box.innerText = '';
                box.style.backgroundImage = `url(${val})`;
            } else {
                box.innerText = val;
                box.style.backgroundImage = 'none';
            }
            refreshTakenAvatars();
        }

        function startGame() {
            const n = document.getElementById('numPlayers').value;
            players = [];
            for(let i=0; i<n; i++) {
                players.push({
                    name: document.getElementById(`name-${i}`).value || `Hero ${i+1}`,
                    avatar: playerSelection[i].val,
                    avatarType: playerSelection[i].type,
                    pos: 1, strikes: 0,
                    color: ['#AA151B', '#166534', '#1e40af', '#92400e'][i]
                });
            }
            document.getElementById('setupArea').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            initBoard();
            updateUI();
        }

        function initBoard() {
            const b = document.getElementById('board');
            b.innerHTML = '';
            for (let r = 9; r >= 0; r--) {
                for (let c = 0; c < 10; c++) {
                    const num = (r % 2 === 0) ? (r * 10 + c + 1) : (r * 10 + (9 - c) + 1);
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `c-${num}`;
                    cell.innerHTML = `<span>${num}</span>`;
                    if (LADDERS.includes(num)) cell.innerHTML += `<span class="obstacle-emoji">ü™ú</span>`;
                    else if (SNAKES.includes(num)) cell.innerHTML += `<span class="obstacle-emoji">üêç</span>`;
                    b.appendChild(cell);
                }
            }
            drawMarkers();
        }

        function rollDice() {
            if(isMoving) return;
            isMoving = true;
            const die = document.getElementById('dice');
            const roll = Math.floor(Math.random() * 6) + 1;
            die.classList.add('rolling');
            document.getElementById('rollBtn').disabled = true;
            setTimeout(() => {
                die.classList.remove('rolling');
                die.innerHTML = `<div class="die-face flex items-center justify-center bg-white border-2 border-stone-200 rounded-xl text-4xl w-full h-full">${['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][roll-1]}</div>`;
                setTimeout(() => {
                    const q = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
                    document.getElementById('quizPrompt').innerText = q.q;
                    document.getElementById('quizBox').classList.remove('hidden');
                    document.getElementById('quizInput').value = '';
                    document.getElementById('quizInput').focus();
                    window.activeRound = { roll, correct: q.a };
                }, 400);
            }, 600);
        }

        function submitAnswer() {
            const input = document.getElementById('quizInput');
            const ans = input.value.trim().toUpperCase();
            if(!['A', 'B', 'C'].includes(ans)) return;
            const p = players[currentPlayer];
            document.getElementById('quizBox').classList.add('hidden');
            if(ans === window.activeRound.correct) {
                p.strikes = 0;
                showFeedback(true);
                movePlayer(p, window.activeRound.roll);
            } else {
                p.strikes++;
                showFeedback(false);
                if(p.strikes >= 3) { p.pos = 1; p.strikes = 0; }
                isMoving = false;
                document.getElementById('rollBtn').disabled = false;
                nextTurn();
            }
        }

        async function movePlayer(p, steps) {
            for(let i=0; i<steps; i++) {
                if(p.pos >= 100) break;
                p.pos++;
                drawMarkers();
                document.getElementById('posDisplay').innerText = p.pos.toString().padStart(2, '0');
                await new Promise(r => setTimeout(r, 200));
            }
            if(LADDERS.includes(p.pos)) {
                await new Promise(r => setTimeout(r, 500));
                p.pos = Math.min(100, p.pos + 10);
                drawMarkers();
            } else if(SNAKES.includes(p.pos)) {
                await new Promise(r => setTimeout(r, 500));
                p.pos = Math.max(1, p.pos - 10);
                drawMarkers();
            }
            if(p.pos >= 100) {
                alert(`¬°FELICIDADES! ${p.name} has ganado.`);
                location.reload(); 
                return;
            }
            isMoving = false;
            document.getElementById('rollBtn').disabled = false;
            if(window.activeRound.roll === 6) {
                updateUI();
                const txt = document.getElementById('feedback-text');
                txt.innerText = 'üî• Extra Turn!';
                document.getElementById('feedback-overlay').classList.replace('opacity-0', 'opacity-100');
                setTimeout(() => document.getElementById('feedback-overlay').classList.replace('opacity-100', 'opacity-0'), 1000);
            } else {
                nextTurn();
            }
        }

        function nextTurn() {
            currentPlayer = (currentPlayer + 1) % players.length;
            updateUI();
        }

        function updateUI() {
            const p = players[currentPlayer];
            const display = document.getElementById('pAvatarDisplay');
            document.getElementById('turnDisplay').innerText = p.name;
            document.getElementById('turnDisplay').style.color = p.color;
            if (p.avatarType === 'image') {
                display.innerText = '';
                display.style.backgroundImage = `url(${p.avatar})`;
            } else {
                display.innerText = p.avatar;
                display.style.backgroundImage = 'none';
            }
            document.getElementById('posDisplay').innerText = p.pos.toString().padStart(2, '0');
            document.querySelectorAll('.strike-dot').forEach((dot, i) => {
                dot.className = i < p.strikes ? 'strike-dot strike-active' : 'strike-dot';
            });
            drawMarkers();
        }

        function drawMarkers() {
            document.querySelectorAll('.player-avatar').forEach(m => m.remove());
            players.forEach((p, i) => {
                const cell = document.getElementById(`c-${p.pos}`);
                if(!cell) return;
                const m = document.createElement('div');
                m.className = `player-avatar ${i === currentPlayer ? 'current-player-glow' : ''}`;
                m.style.backgroundColor = p.color;
                if (p.avatarType === 'image') {
                    m.style.backgroundImage = `url(${p.avatar})`;
                    m.innerText = '';
                } else {
                    m.innerText = p.avatar;
                    m.style.backgroundImage = 'none';
                }
                cell.appendChild(m);
            });
        }

        function showFeedback(correct) {
            const over = document.getElementById('feedback-overlay');
            const txt = document.getElementById('feedback-text');
            txt.innerText = correct ? '‚úÖ' : '‚ùå';
            over.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => over.classList.replace('opacity-100', 'opacity-0'), 800);
        }

        function downloadGameData() {
            const blob = new Blob([JSON.stringify({players, currentPlayer}, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `vocab_save.json`;
            a.click();
        }

        function loadGameData(e) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const d = JSON.parse(ev.target.result);
                players = d.players; currentPlayer = d.currentPlayer;
                document.getElementById('setupArea').classList.add('hidden');
                document.getElementById('gameUI').classList.remove('hidden');
                initBoard(); 
                setTimeout(updateUI, 100);
            };
            reader.readAsText(e.target.files[0]);
        }
    </script>
</body>
</html>
